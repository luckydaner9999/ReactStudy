/*! private_cooker 2016-10-08 */
jQuery(document).ready(function(a){function b(a){var b="undefined"==typeof a?j.hasClass("cart-open"):a;b?(j.removeClass("cart-open"),clearInterval(l),s.removeClass("visible"),n.find(".deleted").remove(),setTimeout(function(){m.scrollTop(0),0==Number(q.find("li").eq(0).text())&&j.addClass("empty")},500)):j.addClass("cart-open")}function c(a){var b=j.hasClass("empty");d(i),g(b),j.removeClass("empty")}function d(b){k+=1;var c=a('<li class="product"><div class="product-image"><a href="#0">'+b.image+'</a></div><div class="product-details"><h3><a href="#0">'+b.dish_name+'</a></h3><div class="quantity"><label for="cd-product-'+k+'">Qty</label><span class="select"><select id="cd-product-'+k+'" name="quantity"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option></select></span></div></div></div></li>');n.prepend(c)}function e(a){clearInterval(l),n.find(".deleted").remove();var b=a.offset().top-m.children("ul").offset().top,c=Number(a.find(".quantity").find("select").val()),d=Number(a.find(".price").text().replace("$",""))*c;a.css("top",b+"px").addClass("deleted"),h(d,!1),g(!0,-c),s.addClass("visible"),l=setTimeout(function(){s.removeClass("visible"),n.find(".deleted").remove()},8e3)}function f(){var b=0,c=0;n.children("li:not(.deleted)").each(function(){var d=Number(a(this).find("select").val());b+=d,c+=d*Number(a(this).find(".price").text().replace("$",""))}),o.text(c.toFixed(2)),q.find("li").eq(0).text(b),q.find("li").eq(1).text(b+1)}function g(a,b){if("undefined"==typeof b){var c=Number(q.find("li").eq(0).text())+1,d=c+1;a?(q.find("li").eq(0).text(c),q.find("li").eq(1).text(d)):(q.addClass("update-count"),setTimeout(function(){q.find("li").eq(0).text(c)},150),setTimeout(function(){q.removeClass("update-count")},200),setTimeout(function(){q.find("li").eq(1).text(d)},230))}else{var c=Number(q.find("li").eq(0).text())+b,d=c+1;q.find("li").eq(0).text(c),q.find("li").eq(1).text(d)}}function h(a,b){b?o.text((Number(o.text())+a).toFixed(2)):o.text((Number(o.text())-a).toFixed(2))}var i,j=a(".cd-cart-container"),k=0;if(j.length>0){var l,m=j.find(".body"),n=m.find("ul").eq(0),o=j.find(".checkout").find("span"),p=j.children(".cd-cart-trigger"),q=p.children(".count"),r=a(".cd-add-to-cart"),s=j.find(".undo");r.on("click",function(b){return i={dish_name:a(this).find("a").eq(0).html(),cid:a(this).find("a").eq(1).html(),u_t:sessionStorage.getItem("tel"),image:a(this).find("a").eq(2).html()},b.preventDefault(),c(a(this)),void 0!=sessionStorage.getItem("tel")?(a.ajax({type:"post",url:"/cooker_menu",data:{dish_name:a(this).find("a").eq(0).html(),cid:a(this).find("a").eq(1).html(),u_t:sessionStorage.getItem("tel")},timeout:3e3,dataType:"json",success:function(a){},error:function(a){}}),!1):void(location.href="/login?url=/cooker_detail?index="+i.cid)}),p.on("click",function(a){a.preventDefault(),b()}),j.on("click",function(c){a(c.target).is(a(this))&&b(!0)}),n.on("click",".delete-item",function(b){b.preventDefault(),e(a(b.target).parents(".product"))}),n.on("change","select",function(a){f()}),s.on("click","a",function(b){clearInterval(l),b.preventDefault(),n.find(".deleted").addClass("undo-deleted").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){a(this).off("webkitAnimationEnd oanimationend msAnimationEnd animationend").removeClass("deleted undo-deleted").removeAttr("style"),f()}),s.removeClass("visible")})}a(".place_order").click(function(){var b=sessionStorage.getItem("tel");return null!=b?(a.ajax({type:"post",url:"/place_order",data:{u_t:sessionStorage.getItem("tel")},timeout:3e3,dataType:"json",success:function(a){0==a.res?swal("您还没有点餐","","error"):location.href="/order_details?cid="+i.cid+"&u_t="+b},error:function(a){}}),!1):void(location.href="/login")})});